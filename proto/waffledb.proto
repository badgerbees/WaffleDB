syntax = "proto3";

package waffledb;

service VectorService {
    rpc Insert(InsertRequest) returns (InsertResponse);
    rpc Search(SearchRequest) returns (SearchResponse);
}

service CollectionService {
    rpc CreateCollection(CreateCollectionRequest) returns (CreateCollectionResponse);
    rpc DeleteCollection(DeleteCollectionRequest) returns (DeleteCollectionResponse);
    rpc ListCollections(ListCollectionsRequest) returns (ListCollectionsResponse);
}

message InsertRequest {
    string collection = 1;
    string id = 2;
    repeated float vector = 3;
    map<string, string> metadata = 4;
}

message InsertResponse {
    string id = 1;
    string status = 2;
}

message SearchRequest {
    string collection = 1;
    repeated float vector = 2;
    int32 top_k = 3;
}

message SearchResponse {
    repeated SearchResult results = 1;
    double latency_ms = 2;
}

message SearchResult {
    string id = 1;
    float distance = 2;
    map<string, string> metadata = 3;
}

message CreateCollectionRequest {
    string name = 1;
    int32 dimension = 2;
    string metric = 3;
}

message CreateCollectionResponse {
    string name = 1;
    int32 dimension = 2;
    string status = 3;
}

message DeleteCollectionRequest {
    string name = 1;
}

message DeleteCollectionResponse {
    string status = 1;
}

message ListCollectionsRequest {}

message ListCollectionsResponse {
    repeated Collection collections = 1;
}

message Collection {
    string name = 1;
    int32 dimension = 2;
    int32 vector_count = 3;
}
